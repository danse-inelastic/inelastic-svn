/*
 * 3dtin.js
 * Copyright (C) 2010  Jayesh Salvi <jayesh@altcanvas.com>
 * All Rights Reserved
 *
 * mjs.js
 * Copyright (c) 2010 Mozilla Corporation
 * Copyright (c) 2010 Vladimir Vukicevic
 */

var n076,n073,n0be,n0cc;try{var t=new WebGLFloatArray(1)}catch(e){WebGLFloatArray=Array}var n01f=Array,V3={};V3._temp1=new n01f(3);V3._temp2=new n01f(3);V3._temp3=new n01f(3);if(n01f==Array){V3.x=[1,0,0];V3.y=[0,1,0];V3.z=[0,0,1];V3.$=function(a,b,c){return[a,b,c]};V3.clone=function(a){return[a[0],a[1],a[2]]}}else{V3.x=new n01f([1,0,0]);V3.y=new n01f([0,1,0]);V3.z=new n01f([0,0,1]);V3.$=function(a,b,c){return new n01f([a,b,c])};V3.clone=function(a){return new n01f(a)}}V3.u=V3.x;V3.v=V3.y;
V3.add=function(a,b,c){if(c==undefined)c=new n01f(3);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c};V3.sub=function(a,b,c){if(c==undefined)c=new n01f(3);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};V3.neg=function(a,b){if(b==undefined)b=new n01f(3);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};V3.direction=function(a,b,c){if(c==undefined)c=new n01f(3);return V3.normalize(V3.sub(a,b,c),c)};V3.length=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])};
V3.n03f=function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]};V3.normalize=function(a,b){if(b==undefined)b=new n01f(3);var c=1/V3.length(a);b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c;return b};V3.scale=function(a,b,c){if(c==undefined)c=new n01f(3);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};V3.mul=V3.scale;V3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};V3.cross=function(a,b,c){if(c==undefined)c=new n01f(3);c[0]=a[1]*b[2]-a[2]*b[1];c[1]=a[2]*b[0]-a[0]*b[2];c[2]=a[0]*b[1]-a[1]*b[0];return c};
V3.dump=function(a,b,c){c!=undefined&&b(c);b("["+a[0].toFixed(3)+a[1].toFixed(3)+a[2].toFixed(3)+"]")};V3.toString=function(a){if(!a)return"null";return"["+a[0].toFixed(3)+", "+a[1].toFixed(3)+", "+a[2].toFixed(3)+"]"};var n0dd={};n0dd._temp1=new n01f(16);n0dd._temp2=new n01f(16);
if(n01f==Array){n0dd.I=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];n0dd.$=function(a,b,c,d,g,h,f,i,j,k,l,m,n,o,p,q){return[a,b,c,d,g,h,f,i,j,k,l,m,n,o,p,q]};n0dd.clone=function(a){return a.slice(0,a.length)}}else{n0dd.I=new n01f([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);n0dd.$=function(a,b,c,d,g,h,f,i,j,k,l,m,n,o,p,q){return new n01f([a,b,c,d,g,h,f,i,j,k,l,m,n,o,p,q])};n0dd.clone=function(a){return new n01f(a)}}n0dd.identity=n0dd.I;
n0dd.n049=function(a,b){if(b==undefined)b=new n01f(16);var c=a[5]*a[10]*a[15]+a[6]*a[11]*a[13]+a[7]*a[9]*a[14]-a[13]*a[10]*a[7]-a[14]*a[11]*a[5]-a[15]*a[9]*a[6],d=(a[4]*a[10]*a[15]+a[6]*a[11]*a[12]+a[7]*a[8]*a[14]-a[12]*a[10]*a[7]-a[14]*a[11]*a[4]-a[15]*a[8]*a[6])*-1,g=a[4]*a[9]*a[15]+a[5]*a[11]*a[12]+a[7]*a[8]*a[13]-a[12]*a[9]*a[7]-a[13]*a[11]*a[4]-a[15]*a[8]*a[5],h=(a[4]*a[9]*a[14]+a[5]*a[10]*a[12]+a[6]*a[8]*a[13]-a[12]*a[9]*a[6]-a[13]*a[10]*a[4]-a[14]*a[8]*a[5])*-1,f=a[0]*c+a[1]*d+a[2]*g+a[3]*
h;if(f==0)throw"matrix not invertible";var i=(a[1]*a[10]*a[15]+a[2]*a[11]*a[13]+a[3]*a[9]*a[14]+-a[13]*a[10]*a[3]-a[14]*a[11]*a[1]-a[15]*a[9]*a[2])*-1,j=a[0]*a[10]*a[15]+a[2]*a[11]*a[12]+a[3]*a[8]*a[14]+-a[12]*a[10]*a[3]-a[14]*a[11]*a[0]-a[15]*a[8]*a[2],k=(a[0]*a[9]*a[15]+a[1]*a[11]*a[12]+a[3]*a[8]*a[13]+-a[12]*a[9]*a[3]-a[13]*a[11]*a[0]-a[15]*a[8]*a[1])*-1,l=a[0]*a[9]*a[14]+a[1]*a[10]*a[12]+a[2]*a[8]*a[13]+-a[12]*a[9]*a[2]-a[13]*a[10]*a[0]-a[14]*a[8]*a[1],m=a[1]*a[6]*a[15]+a[2]*a[7]*a[13]+a[3]*a[5]*
a[14]+-a[13]*a[6]*a[3]-a[14]*a[7]*a[1]-a[15]*a[5]*a[2],n=(a[0]*a[6]*a[15]+a[2]*a[7]*a[12]+a[3]*a[4]*a[14]+-a[12]*a[6]*a[3]-a[14]*a[7]*a[0]-a[15]*a[4]*a[2])*-1,o=a[0]*a[5]*a[15]+a[1]*a[7]*a[12]+a[3]*a[4]*a[13]+-a[12]*a[5]*a[3]-a[13]*a[7]*a[0]-a[15]*a[4]*a[1],p=(a[0]*a[5]*a[14]+a[1]*a[6]*a[12]+a[2]*a[4]*a[13]+-a[12]*a[5]*a[2]-a[13]*a[6]*a[0]-a[14]*a[4]*a[1])*-1,q=(a[1]*a[6]*a[11]+a[2]*a[7]*a[9]+a[3]*a[5]*a[10]+-a[9]*a[6]*a[3]-a[10]*a[7]*a[1]-a[11]*a[5]*a[2])*-1,r=a[0]*a[6]*a[11]+a[2]*a[7]*a[8]+a[3]*
a[4]*a[10]+-a[8]*a[6]*a[3]-a[10]*a[7]*a[0]-a[11]*a[4]*a[2],s=(a[0]*a[5]*a[11]+a[1]*a[7]*a[8]+a[3]*a[4]*a[9]+-a[8]*a[5]*a[3]-a[9]*a[7]*a[0]-a[11]*a[4]*a[1])*-1;a=a[0]*a[5]*a[10]+a[1]*a[6]*a[8]+a[2]*a[4]*a[9]+-a[8]*a[5]*a[2]-a[9]*a[6]*a[0]-a[10]*a[4]*a[1];b[0]=c/f;b[1]=i/f;b[2]=m/f;b[3]=q/f;b[4]=d/f;b[5]=j/f;b[6]=n/f;b[7]=r/f;b[8]=g/f;b[9]=k/f;b[10]=o/f;b[11]=s/f;b[12]=h/f;b[13]=l/f;b[14]=p/f;b[15]=a/f;return b};
n0dd.makeFrustum=function(a,b,c,d,g,h,f){if(f==undefined)f=new n01f(16);f[0]=2*g/(b-a);f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*g/(d-c);f[6]=0;f[7]=0;f[8]=(b+a)/(b-a);f[9]=(d+c)/(d-c);f[10]=-(h+g)/(h-g);f[11]=-1;f[12]=0;f[13]=0;f[14]=-2*h*g/(h-g);f[15]=0;return f};n0dd.n032=function(a,b,c,d,g){a=c*Math.tan(a*Math.PI/360);var h=-a;return n0dd.makeFrustum(h*b,a*b,h,a,c,d,g)};
n0dd.n08a=function(a,b,c,d,g,h,f){if(f==undefined)f=new n01f(16);f[0]=2/(b-a);f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2/(d-c);f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=-2/(h-g);f[11]=0;f[12]=-(b+a)/(b-a);f[13]=-(d+c)/(d-c);f[14]=-(h+g)/(h-g);f[15]=1;return f};
n0dd.mul=function(a,b,c){if(c==undefined)c=new n01f(16);c[0]=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12];c[1]=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13];c[2]=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14];c[3]=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15];c[4]=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12];c[5]=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13];c[6]=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14];c[7]=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15];c[8]=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12];c[9]=b[8]*a[1]+b[9]*a[5]+
b[10]*a[9]+b[11]*a[13];c[10]=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14];c[11]=b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15];c[12]=b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12];c[13]=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13];c[14]=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14];c[15]=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15];return c};
n0dd.makeRotate=function(a,b,c){if(c==undefined)c=new n01f(16);b=V3.normalize(b,V3._temp1);var d=b[0],g=b[1];b=b[2];var h=Math.cos(a),f=1-h;a=Math.sin(a);c[0]=d*d*f+h;c[1]=g*d*f+b*a;c[2]=b*d*f-g*a;c[3]=0;c[4]=d*g*f-b*a;c[5]=g*g*f+h;c[6]=g*b*f+d*a;c[7]=0;c[8]=d*b*f+g*a;c[9]=g*b*f-d*a;c[10]=b*b*f+h;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};n0dd.rotate=function(a,b,c,d){a=n0df.$(b,a);a=n0df.ton0dd(a);return n0dd.mul(c,a,d)};
n0dd.makeScale3=function(a,b,c,d){if(d==undefined)d=new n01f(16);d[0]=a;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=b;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=c;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};n0dd.makeScale1=function(a,b){return n0dd.makeScale3(a,a,a,b)};n0dd.makeScale=function(a,b){return n0dd.makeScale3(a[0],a[1],a[2],b)};n0dd.scale3=function(a,b,c,d,g){n0dd.makeScale3(a,b,c,n0dd._temp1);return n0dd.mul(d,n0dd._temp1,g)};
n0dd.scale1=function(a,b,c){n0dd.makeScale3(a,a,a,n0dd._temp1);return n0dd.mul(b,n0dd._temp1,c)};n0dd.scale=function(a,b,c){n0dd.makeScale3(a[0],a[1],a[2],n0dd._temp1);return n0dd.mul(b,n0dd._temp1,c)};n0dd.makeTranslate3=function(a,b,c,d){if(d==undefined)d=new n01f(16);d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=a;d[13]=b;d[14]=c;d[15]=1;return d};n0dd.makeTranslate1=function(a,b){return n0dd.makeTranslate3(a,a,a,b)};
n0dd.makeTranslate=function(a,b){return n0dd.makeTranslate3(a[0],a[1],a[2],b)};n0dd.translate3=function(a,b,c,d,g){n0dd.makeTranslate3(a,b,c,n0dd._temp1);return n0dd.mul(d,n0dd._temp1,g)};n0dd.translate1=function(a,b,c){n0dd.makeTranslate3(a,a,a,n0dd._temp1);return n0dd.mul(b,n0dd._temp1,c)};n0dd.translate=function(a,b,c){n0dd.makeTranslate3(a[0],a[1],a[2],n0dd._temp1);return n0dd.mul(b,n0dd._temp1,c)};
n0dd.n092=function(a,b){if(a==b){b=0;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return a}if(b==undefined)b=new n01f(16);b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};
n0dd.mulV3=function(a,b,c){if(c==undefined)c=new n01f(4);c[0]=a[0]*b[0]+a[4]*b[1]+a[8]*b[2]+a[12];c[1]=a[1]*b[0]+a[5]*b[1]+a[9]*b[2]+a[13];c[2]=a[2]*b[0]+a[6]*b[1]+a[10]*b[2]+a[14];c[3]=a[3]*b[0]+a[7]*b[1]+a[11]*b[2]+a[15];return c};
n0dd.toString=function(a){return"{"+a[0].toFixed(3)+","+a[4].toFixed(3)+","+a[8].toFixed(3)+","+a[12].toFixed(3)+"}, \n{"+a[1].toFixed(3)+","+a[5].toFixed(3)+","+a[9].toFixed(3)+","+a[13].toFixed(3)+"}, \n{"+a[2].toFixed(3)+","+a[6].toFixed(3)+","+a[10].toFixed(3)+","+a[14].toFixed(3)+"}, \n{"+a[3].toFixed(3)+","+a[7].toFixed(3)+","+a[11].toFixed(3)+","+a[15].toFixed(3)+"} \n"};var n0df={};
n0df.$=function(a,b){var c=Math.cos(b/2),d=Math.sin(b/2);b=a[0]*d;var g=a[1]*d;a=a[2]*d;d=new n01f(4);d[0]=b;d[1]=g;d[2]=a;d[3]=c;return d};n0df.ton0dd=function(a,b){if(b==undefined)b=new n01f(16);var c=a[0],d=a[1],g=a[2];a=a[3];b[0]=1-2*(d*d+g*g);b[1]=2*(c*d+g*a);b[2]=2*(c*g-d*a);b[3]=0;b[4]=2*(c*d-g*a);b[5]=1-2*(c*c+g*g);b[6]=2*(g*d+c*a);b[7]=0;b[8]=2*(c*g+d*a);b[9]=2*(d*g-c*a);b[10]=1-2*(c*c+d*d);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
n0df.mul=function(a,b,c){if(c==undefined)c=new n01f(4);c[0]=a[3]*b[0]+a[0]*b[3]+a[1]*b[2]-a[2]*b[1];c[1]=a[3]*b[1]+a[1]*b[3]+a[2]*b[0]-a[0]*b[2];c[2]=a[3]*b[2]+a[2]*b[3]+a[0]*b[1]-a[1]*b[0];c[3]=a[3]*b[3]-a[0]*b[0]-a[1]*b[1]-a[2]*b[2];return c};
n0df.toEuler=function(a){var b=a[0]*a[0],c=a[1]*a[1],d=a[2]*a[2],g=a[3]*a[3],h=b+c+d+g,f=a[0]*a[1]+a[2]*a[3];if(f>0.499*h){var i=2*atan2(a[0],a[3]);h=Math.PI/2;a=0;return[a,i,h]}if(f<-0.499*h){i=-2*atan2(a[0],a[3]);h=-Math.PI/2;a=0;return[a,i,h]}i=Math.atan2(2*a[1]*a[3]-2*a[0]*a[2],b-c-d+g);h=Math.asin(2*f/h);a=Math.atan2(2*a[0]*a[3]-2*a[1]*a[2],-b+c-d+g);return[a,i,h]};n0df.toString=function(a){return"x = "+a[0].toFixed(3)+" y = "+a[1].toFixed(3)+" z = "+a[2].toFixed(3)+" w = "+a[3].toFixed(3)};
var n0bd=function(){};n0bd.n04a=function(a){if(n0d3==n07c)var b=a[0],c=a[1];else{b=-n0db*(a[0]/a[2]);c=-n0db*(a[1]/a[2])}a=canvas.height;b=canvas.width/2*(b/n0d9+1);c=a/2*(c/n0e0+1);c=a-c;return[b,c]};n0bd.n075=function(a,b){gl.save();if(b)gl.strokeStyle=b;gl.beginPath();gl.moveTo(a[0][0],a[0][1]);gl.lineTo(a[1][0],a[1][1]);gl.closePath();gl.stroke();gl.restore()};
n0bd.prototype={quads:[],n0c3:function(){},n0b2:function(a){this.quads.push(a)},n05d:function(){function a(b,c){b=Math.min(b.vertices[0][2],b.vertices[1][2],b.vertices[2][2],b.vertices[3][2]);c=Math.min(c.vertices[0][2],c.vertices[1][2],c.vertices[2][2],c.vertices[3][2]);return b-c}this.quads.sort(a)},print:function(){log("-- Quads --");for(var a=0;a<this.quads.length;a++)log(this.quads[a].id)},n09b:function(){this.n05d();var a=this.quads.length;gl.save();for(var b=0;b<a;b++){var c=this.quads[b];
if(c.style){gl.fillStyle=c.style;gl.strokeStyle=c.style}var d=n0bd.n04a(c.vertices[0]),g=n0bd.n04a(c.vertices[1]),h=n0bd.n04a(c.vertices[2]);c=n0bd.n04a(c.vertices[3]);gl.beginPath();gl.moveTo(d[0],d[1]);gl.lineTo(g[0],g[1]);gl.lineTo(h[0],h[1]);gl.lineTo(c[0],c[1]);gl.lineTo(d[0],d[1]);gl.closePath();gl.fill();gl.stroke();n0da.quadCount++}gl.restore();this.quads=[]}};var gl,canvas=null,n0ac,n04d,n035,n016;
function n09f(){gl=canvas.getContext("2d");n0ac=101;n04d=102;n035=103;n016=104;n053=function(a){gl.lineWidth=a};$("#webglerrmsg").remove();return true}function n090(){}function n050(a){return a}
function n052(a,b,c,d,g){function h(k,l){return l.slice(3*k,3*k+3)}if(g==n0ac)if(d){b=d.length/2;for(g=0;g<b;g++){var f=h(d[2*g],a);f=n0dd.mulV3(n0da.n0af,f);f=n0bd.n04a(f);var i=h(d[2*g+1],a);i=n0dd.mulV3(n0da.n0af,i);i=n0bd.n04a(i);if(c){idx0=d[2*g];var j=c.slice(4*idx0,4*idx0+4);j="rgba("+255*j[0]+","+255*j[1]+","+255*j[2]+","+j[3]+")"}n0bd.n075([f,i],j)}}else{b=a.length/6;for(g=0;g<b;g++){f=h(2*g,a);f=n0dd.mulV3(n0da.n0af,f);f=n0bd.n04a(f);i=h(2*g+1,a);i=n0dd.mulV3(n0da.n0af,i);i=n0bd.n04a(i);
if(c){j=c.slice(8*g,8*g+4);j="rgba("+255*j[0]+","+255*j[1]+","+255*j[2]+","+j[3]+")"}n0bd.n075([f,i],j)}}else if(g==n04d)throw"unexpected";}n0cc=n09f;n0be=n090;n073=n050;n076=n052;Op=function(a,b){this.type=a;this.cubes=b};Op.n0e1=0;Op.n0ca=1;function n0de(a,b){this.rgba=b;this.color=[b.r/255,b.g/255,b.b/255,b.a/100];this.position=a;this.n068=[];this.n0c4()}n0de.n0dc=0.3;n0de.n0c1=n0de.n0dc/2;n0de.n0bb=1.414*n0de.n0dc;n0de.n07e=n0de.n0bb/2;
n0de.vertices=[-n0de.n0c1,-n0de.n0c1,-n0de.n0c1,n0de.n0c1,-n0de.n0c1,-n0de.n0c1,n0de.n0c1,n0de.n0c1,-n0de.n0c1,-n0de.n0c1,n0de.n0c1,-n0de.n0c1,-n0de.n0c1,-n0de.n0c1,n0de.n0c1,n0de.n0c1,-n0de.n0c1,n0de.n0c1,n0de.n0c1,n0de.n0c1,n0de.n0c1,-n0de.n0c1,n0de.n0c1,n0de.n0c1];n0de.normals=[[0,0,-1],[0,0,1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]];n0de.faces=[[3,2,1,0],[4,5,6,7],[7,6,2,3],[5,4,0,1],[6,5,1,2],[4,7,3,0]];n0de.n09a=function(a){return n0de.vertices.slice(3*a,3*a+3)};
n0de.n07a=function(a,b){a=n0dd.mulV3(n0da.nMatrix,a);a=Math.max(V3.dot(a,n0da.n0a3),0);a=V3.add(n0da.n0a0,V3.mul(n0da.n0a9,a));b=[b[0]*a[0],b[1]*a[1],b[2]*a[2],b[3]];return"rgba("+parseInt(255*b[0])+","+parseInt(255*b[1])+","+parseInt(255*b[2])+","+b[3]+")"};
n0de.prototype={n0c4:function(){for(var a=[],b=0;b<72;b+=3)a=a.concat(this.color);this.cBuffer=n073(a,n035,"float",4,a.length)},realpos:function(){return[n0de.n0dc*this.position[0],n0de.n0dc*this.position[1],n0de.n0dc*this.position[2]]},draw:function(){n0da.save();n0da.translate([this.position[0]*n0de.n0dc,this.position[1]*n0de.n0dc,this.position[2]*n0de.n0dc]);if(show3D)n076(n0de.vBuffer,n0de.nBuffer,this.cBuffer,n0de.iBuffer,n04d);else{for(var a=0;a<6;a++)if(n0de.n061[a])if(!(this.n068.indexOf(a)>=
0)){for(var b=[],c=0;c<4;c++){var d=n0de.n09a(n0de.faces[a][c]);d=n0dd.mulV3(n0da.n0af,d);b.push(d)}c=n0da.n04c(this.rgba,n0de.normals[a]);n0da.proxy.n0b2({vertices:b,style:c})}n0da.proxy.n09b()}n0da.restore()}};var n0db=0.1,n0e4=100,n0e2=45,n0cb=1,n0d9,n0e0;function n0da(){}n0da.pMatrix=null;n0da.n0af=null;n0da.nMatrix=null;n0da.zoom=n0e2;n0da.n0d1=45;n0da.n0d2=-10;n0da.n0cd=0;n0da.n062=[0,0,10];n0da.n025=true;
n0da.init=function(){if(show3D){gl.clearColor(0.96,0.96,0.96,1);gl.clearDepth(1);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL)}else n0da.proxy=new n0bd};n0da.n0ad=function(a){n0da.n0b1=a};n0da.n0c4=function(){n0d8.n05b();n0da.n0b1!=null&&n0da.n0b1.n0c4()};n0da.n05e=function(){n0da.n0b1&&n0da.n0b1.n0b5&&window.localStorage&&window.localStorage.setItem("tmptin",n0da.n0b1.toString())};
n0da.n021=function(){if(window.localStorage){var a=window.localStorage.getItem("tmptin");if(a){n0da.n0b1=new n0d8;n0da.n0b1.fromString(a);n0da.n0c4();n0da.draw();window.localStorage.removeItem("tmptin");return true}else return false}};
n0da.n0c6=function(){if(isLoggedIn){params={};if(!isCCNShown){alert("Note\n\nAll the sketches saved in 3DTin are visible to everyone and shared under Creative Commons 3.0 (Attribution Share Alike) license.");isCCNShown=true;params.markCCNShown=true}if(n0da.n0b1.uid&&n0da.n0b1.uid!="_SAMPLE_")params.uid=n0da.n0b1.uid;if(!n0da.n0b1.name||n0da.n0b1.name=="_SAMPLE_"){var a=prompt("Enter name");if(a.trim()==""){alert("Please enter non empty name");return}n0da.n0b1.name=a}params.content=n0da.n0b1.toString();
params.name=n0da.n0b1.name;params.thumbnail=n048();n09c("Saving...");$.post("/_save",params,function(b){b=JSON.parse(b);if(b.result!="SUCCESS")alert(b.result);else{n0da.n0b1.uid=b.uid;n0da.n0b1.n0b5=false;n09c(null);n034()}})}else{a="You need to login first";if(window.localStorage)a+="\nYour sketch will be stored temporarily";alert(a)}};
n0da.n0c2=function(a){if(n0da.n0b1&&n0da.n0b1.n0b5)if(!confirm("You have unsaved changes. Proceed Anyway?"))return;n09c("Loading...");$.post("/_load",{uid:a},function(b){b=JSON.parse(b);if(b.result!="SUCCESS")alert("Load failure: "+b.result);else{n0da.n0b1=new n0d8;try{n0da.n0b1.fromString(b.content)}catch(c){alert("Failed to load: "+c);n09c(null);return}n0da.n0b1.uid=b.uid;n0da.n0b1.name=b.name;n0da.n0c4();n0da.draw();n034();n09c(null)}})};
n0da.n0a4=function(){isLoggedIn?$.post("/_list",null,function(a){a=JSON.parse(a);if(a.result!="SUCCESS")alert(a.result);else{$("#tinlist").empty();for(var b=0;b<a.list.length;b++)$("#tinlist").append('<span class="tinentry" id='+a.list[b].uid+">"+a.list[b].name+"</span><br/>");$(".tinentry").click(function(){n0da.n0c2($(this).attr("id"));$("#tinlistdlg").fadeOut()});showListDialog()}}):alert("You need to login first")};
function showListDialog(){var a=(canvas.height-300)/2;$("#tinlistdlg").css("margin-top",parseInt(a)+"px");a=(canvas.width-600)/2;$("#tinlistdlg").css("margin-left",parseInt(a)+"px");$("#tinlistdlg").fadeIn()}n0da.n04b=function(){var a=n0dd.mulV3(n0da.n0af,[0,0,0]),b=n0dd.mulV3(n0da.n0af,[1,0,0]),c=n0dd.mulV3(n0da.n0af,[0,0,1]);n0ba=new n0d6([a,c,b])};n0da.n02f=function(){return n0da.n055};
n0da.n036=function(a){$.jPicker.List[0]&&$.jPicker.List[0].color.active.val("rgba",a);var b="rgba("+a.r+","+a.g+","+a.b+","+a.a+")";n0da.n055=a;$("#add").css("background-color",b)};var n0aa=0,n05a=1,n08c=2,n07b=3,n083=4,n098=5;
n0da.n0c9=function(a){switch(a){case n0aa:n0da.n0d1=90;n0da.n0d2=0;n0da.n0cd=0;n0da.n062[0]=0;n0da.n062[1]=0;n0da.n062[2]=10;break;case n05a:n0da.n0d1=-90;n0da.n0d2=0;n0da.n0cd=0;n0da.n062[0]=0;n0da.n062[1]=0;n0da.n062[2]=10;break;case n08c:n0da.n0d1=0;n0da.n0d2=90;n0da.n0cd=0;n0da.n062[0]=0;n0da.n062[1]=0;n0da.n062[2]=10;break;case n07b:n0da.n0d1=0;n0da.n0d2=-90;n0da.n0cd=0;n0da.n062[0]=0;n0da.n062[1]=0;n0da.n062[2]=10;break;case n083:n0da.n0d1=0;n0da.n0d2=0;n0da.n0cd=0;n0da.n062[0]=0;n0da.n062[1]=
0;n0da.n062[2]=10;break;case n098:n0da.n0d1=0;n0da.n0d2=180;n0da.n0cd=0;n0da.n062[0]=0;n0da.n062[1]=0;n0da.n062[2]=10;break}n0da.draw()};
function n089(){var a=n0dd.clone(n0dd.I);a=n0dd.rotate(Math.PI*n0da.n0d1/180,V3.x,a);a=n0dd.rotate(Math.PI*n0da.n0d2/180,V3.y,a);a=n0dd.rotate(Math.PI*n0da.n0cd/180,V3.z,a);n0de.n061=[];n0da.n088=[];for(var b=0;b<6;b++){var c=n0dd.mulV3(a,n0de.normals[b]);c=V3.dot(c,[0,0,-1]);n0da.n088.push(c);n0de.n061[b]=c<=0}a=Math.abs(n0da.n088[0]);b=Math.abs(n0da.n088[2]);c=Math.abs(n0da.n088[4]);n0da.n065=c>b?c>a?0:2:b>a?1:2}
n0da.draw=function(){n0da.pMatrix=n0d3==n079?n0dd.n032(n0da.zoom,n0cb,n0db,n0e4):n0dd.n08a(-n0d9,n0d9,-n0e0,n0e0,n0db,n0e4);n089();n0da.n0af=n0dd.clone(n0dd.I);n0da.n0af=n0dd.translate3(-n0da.n062[0],-n0da.n062[1],-n0da.n062[2],n0da.n0af);n0da.n0af=n0dd.rotate(Math.PI*n0da.n0d1/180,V3.x,n0da.n0af);n0da.n0af=n0dd.rotate(Math.PI*n0da.n0d2/180,V3.y,n0da.n0af);n0da.n0af=n0dd.rotate(Math.PI*n0da.n0cd/180,V3.z,n0da.n0af);n0da.nMatrix=n0dd.n049(n0da.n0af);n0da.nMatrix=n0dd.n092(n0da.nMatrix);if(show3D){gl.clear(gl.COLOR_BUFFER_BIT|
gl.DEPTH_BUFFER_BIT);gl.uniform3f(n041.n022,0.2,0.2,0.2);gl.uniform3f(n041.n015,0.8,0.8,0.8);var a=V3.normalize(V3.$(-0.25,-0.25,-1));gl.uniform3f(n041.n01a,-1*a[0],-1*a[1],-1*a[2]);gl.uniform1i(n041.n033,true)}else{n0da.n0a0=[0.2,0.2,0.2];n0da.n0a9=[0.8,0.8,0.8];a=V3.normalize(V3.$(-0.25,-0.25,-1));n0da.n0a3=[-1*a[0],-1*a[1],-1*a[2]];gl.clearRect(0,0,canvas.width,canvas.height)}n0d8.n0a5();if(n0da.n0b1!=null){n0da.quadCount=0;n0da.colorBag={};n0da.n0b1.draw()}};n0da.colorBag={};
n0da.n04c=function(a,b){var c=[a.r,a.g,a.b,a.a],d=c.join("_")+"_"+b.join("_");c=n0da.colorBag[d];if(!c){c=[a.r/255,a.g/255,a.b/255,a.a/100];a=n0dd.mulV3(n0da.nMatrix,b);a=Math.max(V3.dot(a,n0da.n0a3),0);a=V3.add(n0da.n0a0,V3.mul(n0da.n0a9,a));c=[c[0]*a[0],c[1]*a[1],c[2]*a[2],c[3]];c="rgba("+parseInt(255*c[0])+","+parseInt(255*c[1])+","+parseInt(255*c[2])+","+c[3]+")";n0da.colorBag[d]=c}return c};n0da.project=function(a){return n0dd.mulV3(n0da.n0af,a)};
n0da.n097=function(a){var b=n0dd.n049(n0da.n0af);return n0dd.mulV3(b,a)};n0da.n03d=[];n0da.save=function(){n0da.n03d.push(n0dd.clone(n0da.n0af))};n0da.restore=function(){if(n0da.n03d.length==0)throw"Invalid popMatrix!";n0da.n0af=n0da.n03d.pop()};n0da.translate=function(a){n0da.n0af=n0dd.translate(a,n0da.n0af)};n0da.scale=function(a){n0dd.scale(a,n0da.n0af,n0da.n0af)};n0da.rotate=function(a,b){n0da.n0af=n0dd.rotate(a*Math.PI/180,b,n0da.n0af)};var n0ae=100;
function n0d8(){this.n078=[];this.sorted=[];this.cmap={};this.n0b5=false}
n0d8.prototype={n0c4:function(){for(var a=0;a<this.n078.length;a++){var b=this.n078[a];b.n085||b.n0c4()}},n0ce:function(a){a=a.join("_");return this.cmap[a]!=undefined?this.n078[this.cmap[a]]:null},n0c5:function(a){var b=a.position.join("_");if(this.cmap[b]==undefined){this.cmap[b]=this.n078.length;this.n078.push(a);n0da.n025&&this.n02c(a,true)}},n02c:function(a,b){var c=a.position;a.n068=[];c=[[c[0],c[1],c[2]-1],[c[0],c[1],c[2]+1],[c[0],c[1]+1,c[2]],[c[0],c[1]-1,c[2]],[c[0]+1,c[1],c[2]],[c[0]-1,
c[1],c[2]]];for(var d=0;d<6;d++){var g=this.n0ce(c[d]);if(g){a.n068.push(d);b&&this.n02c(g,false)}}},n081:function(a){var b=a.position.join("_");if(this.cmap[b]!=undefined){var c=this.cmap[b];a=this.n078[c];this.n078[c]=null;this.cmap[b]=null;this.n02c(a,true);return a}return null},print:function(){log("<MAP --");for(var a in this.cmap)log(a+" = "+this.cmap[a]);log("-- MAP>")},n0d5:function(){this.sorted.splice(0,this.sorted.length);for(var a=this.n078.length,b=0;b<a;b++){var c=this.n078[b];c&&this.sorted.push(c)}this.sorted.sort(function(d,
g){d=n0dd.mulV3(n0da.n0af,d.position);g=n0dd.mulV3(n0da.n0af,g.position);return d[2]-g[2]})},draw:function(){this.n0d5();for(var a=this.sorted.length,b=0;b<a;b++){var c=this.sorted[b];c.n085||c.draw()}},n019:function(a,b){for(var c=this.n078.length,d=[],g=0;g<c;g++){var h=this.n078[g];if(h){var f=n0da.project(h.realpos()),i=V3.dot(a.d,V3.sub(f,a.o));i/=V3.n03f(a.d);i=V3.add(a.o,V3.mul(a.d,i));f=V3.sub(f,i);V3.length(f)<b&&d.push(h)}}a=null;b=-1000;c=d.length;for(g=0;g<c;g++){f=n0da.project(d[g].realpos());
if(f[2]>b){a=d[g];b=f[2]}}return a},n024:function(a,b){if(b=this.n019(a,b)){var c=b.realpos();a=n0da.n097(a.o);c=V3.sub(c,a);a=c.slice(0,3);a.sort(function(d,g){return Math.abs(d)-Math.abs(g)});a=c.indexOf(a[2]);c=-1*c[a]/Math.abs(c[a]);b=b.position.slice(0,3);b[a]+=c;return b}return null},n03e:function(a,b){b=b.realpos();switch(n0da.n065){case 0:var c=[b[0],b[1],b[2]],d=[b[0],b[1]+n0de.n0dc,b[2]],g=[b[0],b[1],b[2]+n0de.n0dc];break;case 1:c=[b[0],b[1],b[2]];d=[b[0]+n0de.n0dc,b[1],b[2]];g=[b[0],b[1],
b[2]+n0de.n0dc];break;case 2:c=[b[0],b[1],b[2]];d=[b[0],b[1]+n0de.n0dc,b[2]];g=[b[0]+n0de.n0dc,b[1],b[2]];break}c=n0dd.mulV3(n0da.n0af,c);d=n0dd.mulV3(n0da.n0af,d);g=n0dd.mulV3(n0da.n0af,g);a=(new n0d6([c,d,g])).n096(a);return n0d7(n0da.n097(a))},n0b4:function(a){switch(a.type){case Op.n0e1:for(var b=a.cubes.length,c=0;c<b;c++)this.n0c5(a.cubes[c]);break;case Op.n0ca:b=a.cubes.length;for(c=0;c<b;c++)this.n081(a.cubes[c]);break}},n086:function(a){switch(a.type){case Op.n0e1:for(var b=a.cubes.length,
c=0;c<b;c++)this.n081(a.cubes[c]);break;case Op.n0ca:b=a.cubes.length;for(c=0;c<b;c++)this.n0c5(a.cubes[c]);break}},opq:[],n0a1:0,n091:0,do_:function(a){this.n0b5=true;this.opq[this.n0a1]=a;this.n0a1=(this.n0a1+1)%n0d8.n070;$("#undo").css("background-image","url('/images/undo.png')");this.n091=0},undo:function(){if(this.n091!=n0d8.n070-1){this.n0a1--;if(this.n0a1<0)this.n0a1=n0d8.n070-1;if(this.opq[this.n0a1]){this.n086(this.opq[this.n0a1]);$("#redo").css("background-image","url('/images/redo.png')");
this.n091++;this.n091==n0d8.n070-1&&$("#undo").css("background-image","url('/images/noundo.png')")}else this.n0a1=(this.n0a1+1)%n0d8.n070}},redo:function(){if(this.n091!=0){this.n0b4(this.opq[this.n0a1]);this.n0a1=(this.n0a1+1)%n0d8.n070;this.n091--;this.n091==0&&$("#redo").css("background-image","url('/images/noredo.png')")}}};n0d8.n070=10;n0d8.n08f=false;
n0d8.n05b=function(){if(!n0d8.n08f){n0d8.n084=n073([-n0ae,0,0,n0ae,0,0,0,0,-n0ae,0,0,n0ae],n035,"float",3,4);n0d8.n07d=n073([1,0,0,1,1,0,0,1,0,0,1,1,0,0,1,1],n035,"float",4,4);n0d8.n03c=n073([0,1,0,0,1,0,1,0,0,1,0,0],n035,"float",3,4);n0d8.n08f=true}};n0d8.n0a5=function(){if(n0d8.n08f){n053(1);n076(n0d8.n084,n0d8.n03c,n0d8.n07d,null,n0ac)}};
n0d8.prototype.fromString=function(a){this.n078=[];a=JSON.parse(a);if(!a.specversion)throw"Old experimental format (now unsupported)";for(var b=0;b<a.objects.length;b++){var c=a.objects[b].locations,d=c.length,g=a.objects[b].colors;if(g.length!=d/3)throw"Corrupt file";for(var h=0;h<d/3;h++){var f=c.slice(3*h,3*h+3),i=a.colorlist.slice(4*g[h],4*g[h]+4);this.n0c5(new n0de(f,{r:i[0],g:i[1],b:i[2],a:i[3]}))}}if(a.currentcolor){g=a.currentcolor;n0da.n036({r:g[0],g:g[1],b:g[2],a:g[3]})}if(a.camera){n0d3=
a.camera.projection=="p"?n079:n07c;n043(n0d3)}if(a.icamera){n0da.n062=a.icamera.translate;n0da.n0d1=a.icamera.xrotate;n0da.n0d2=a.icamera.yrotate;n0da.n0cd=a.icamera.zrotate}};
n0d8.prototype.toString=function(){function a(i){i=[i.r,i.g,i.b,i.a];for(var j=0;j<g.length;j++){var k=g[j];if(k[0]==i[0]&&k[1]==i[1]&&k[2]==i[2]&&k[3]==i[3])return j}j=g.length;g.push(i);return j}for(var b=this.n078.length,c=[],d=[],g=[],h=0;h<b;h++){var f=this.n078[h];if(f){c.push(f.position);f=a(f.rgba);d.push(f)}}b=n0d3==n079?"p":"o";h=n0da.n02f();h=[h.r,h.g,h.b,h.a];f="{";f+='"filetype":"cubicle",';f+='"specversion":"0.1",';f+='"colorlist" : ['+g+"],";f+='"objects" : [';f+="{";f+='"locations" : ['+
c+"],";f+='"colors" : ['+d+"]";f+="}";f+="],";f+='"currentcolor": ['+h+"],";f+='"camera" : {';f+='"projection": "'+b+'"';f+="},";f+='"icamera" : {';f+='"translate" : ['+n0da.n062+"],";f+='"xrotate" : '+n0da.n0d1+",";f+='"yrotate" : '+n0da.n0d2+",";f+='"zrotate" : '+n0da.n0cd+"";f+="}";f+="}";return f};function n013(a,b,c,d,g){return n082(a,b,c,d,g)}
function n082(a,b,c,d,g){a=V3.$(n0d9*(2*a/c-1),n0e0*(2*b/d-1),-1*n0db);if(n0d3==n07c)return V3.$(a[0],a[1],g[2]);else{a=V3.direction(a,V3.$(0,0,0));b=g[2]/a[2];return V3.$(b*a[0],b*a[1],g[2])}}function n023(a,b,c,d){var g=V3.$(n0d9*(2*a/c-1),n0e0*(2*b/d-1),-1*n0db);if(n0d3==n07c)a=V3.$(n0d9*(2*a/c-1),n0e0*(2*b/d-1),-1*n0e4);else{a=V3.direction(g,V3.$(0,0,0));b=(-n0e4- -n0db)/a[2];a=V3.$(b*a[0],b*a[1],-n0e4)}return[g,a]}
var n0d6=function(a){this.normal=V3.cross(V3.sub(a[1],a[0]),V3.sub(a[2],a[1]));V3.normalize(this.normal);this.apoint=a[0];this.d=-1*V3.dot(a[0],this.normal)};
n0d6.prototype={n0a2:function(a){return V3.dot(this.normal,a)+this.d},contains:function(a){return this.n0a2(a)<n0b6},project:function(a){vdotn=V3.dot(a,this.normal);return V3.sub(a,V3.mul(this.normal,vdotn))},n0bf:function(a){return V3.add(a,V3.mul(this.normal,-2*this.n0a2(a)))},n096:function(a){var b=V3.dot(this.normal,a.d),c;if(Math.abs(b)<n0b6)if(Math.abs(a.o[0]*this.normal[0]+a.o[1]*this.normal[1]+a.o[2]*this.normal[2]+this.d)<n0b6)throw"n0e3 in plane";else return null;c=-(this.normal[0]*a.o[0]+
this.normal[1]*a.o[1]+this.normal[2]*a.o[2]+this.d);c/=b;return V3.add(a.o,V3.mul(a.d,c))}};var n0e3=function(a,b){this.o=a;this.d=V3.sub(b,a)},n0b6=0.2;function n01d(a,b,c){}function n08e(a){if(a.which==2){n045=false;n051("pointer");return false}n045&&n030();n099&&n046();if(n09d){n0da.n0b1.do_(n09d);n09d=null}n059=n087=false;n0c0=null;return false}
function n063(a){n0cf=a.clientX;n0d0=a.clientY;if(action==n042){a.shiftKey?n040(a):n02b();return false}if(action==n06c){var b=n0da.n02f(),c=n0da.n0b1.n024(n0b8(a),n0de.n07e);if(!c){n0da.n04b();pos=getPosition(a);c=n0d7(pos)}a=new n0de(c,b);n0c0=a.realpos();n064=a;if(n0da.n0b1.n0ce(c))n09d=new Op(Op.n0e1,[]);else{n0da.n0b1.n0c5(a);n09d=new Op(Op.n0e1,[a])}n087=true}else if(action==n047){if(a=n0da.n0b1.n019(n0b8(a),n0de.n0dc)){c=n0da.n0b1.n081(a);n09d=new Op(Op.n0ca,[c])}n059=true}n0da.draw();return false}
function n0b8(a){a=n023(a.clientX,canvas.height-a.clientY,canvas.width,canvas.height);return new n0e3(a[0],a[1])}function getPosition(a){a=n0b8(a);a=n0ba.n096(a);return n0da.n097(a)}function n0d7(a){return[parseInt((a[0]/n0de.n0dc).toFixed(3)),parseInt((a[1]/n0de.n0dc).toFixed(3)),parseInt((a[2]/n0de.n0dc).toFixed(3))]}
function n06b(a){if(n045){var b=a.clientX-prevX>0;if(b!=dirX)n0cf=a.clientX;dirX=b;b=a.clientY-prevY>0;if(b!=dirY)n0d0=a.clientY;dirY=b;n0da.n0d2+=5*(a.clientX-n0cf)/canvas.width;n0da.n0d1+=5*(a.clientY-n0d0)/canvas.height;prevX=a.clientX;prevY=a.clientY;n0da.draw();return false}if(n099){b=n013(a.clientX,canvas.height-a.clientY,canvas.width,canvas.height,n0da.project(V3.$(0,0,0)));b=n0da.n097(b);var c=V3.mul(V3.sub(n0c0,b),0.2);n0da.n062=V3.add(n0da.n062,c);n0c0=b;prevX=a.clientX;prevY=canvas.height-
a.clientY;n0da.draw();return false}if(action==n06c&&n087){b=$.jPicker.List[0].color.active.val("rgba");a=n0da.n0b1.n03e(n0b8(a),n064);b=new n0de(a,b);n0c0=b.realpos();if(!n0da.n0b1.n0ce(a)){n0da.n0b1.n0c5(b);n09d.cubes.push(b)}}else if(action==n047&&n059)if(b=n0da.n0b1.n019(n0b8(a),n0de.n0dc)){a=n0da.n0b1.n081(b);if(n09d)n09d.cubes.push(a);else n09d=new Op(Op.n0ca,[a])}n0da.draw();return false}
var n094=0,n06c=1,n047=2,n042=3,action=n094,n0cf,n0d0,prevX,prevY,dirX=true,dirY=true,n0c0,n045,n099,n072,n079=1,n07c=2,n0d3=n079,n087=false,n059=false,n0c7,n0b9,n0ba;function n0bc(){return false}
function n0a7(){$(document).bind("keydown","a",function(){n095();return false});$(document).bind("keydown","e",function(){n060();return false});$(document).bind("keydown","c",function(){$.jPicker.List[0].show();return false});$(document).bind("keydown","r",function(){n056();return false});$(document).bind("keydown","esc",function(){n074();$.jPicker.List[0].hide();return false});$(document).bind("keydown","ctrl+h",function(){n0a6();return false});$("#help").mousedown(function(){n0a6();return false});
$(document).bind("keydown","ctrl+k",function(){debug();return false});$(document).bind("keydown","ctrl+n",function(){n04e();return false});$(document).bind("keydown","ctrl+z",function(){undo();return false});$(document).bind("keydown","ctrl+y",function(){redo();return false});$(document).bind("keydown","ctrl+up",function(){n0da.n0c9(n0aa);return false});$(document).bind("keydown","ctrl+down",function(){n0da.n0c9(n05a);return false});$(document).bind("keydown","ctrl+left",function(){n0da.n0c9(n08c);
return false});$(document).bind("keydown","ctrl+right",function(){n0da.n0c9(n07b);return false});$(document).bind("keydown","shift+up",function(){n0da.n0c9(n083);return false});$(document).bind("keydown","shift+down",function(){n0da.n0c9(n098);return false});$(document).bind("keydown","ctrl+s",function(){n0da.n0c6();return false});$(document).bind("keydown","ctrl+o",function(){n0da.n0a4();return false})}function debug(){n043(n0d3==n079?n07c:n079);n0da.draw()}
function n08d(){$("#new").mousedown(function(){n04e();return false});$("#new").mouseup(n0bc);$("#add").mousedown(function(){n095();return false});$("#remove").mousedown(function(){n060();return false});$("#rotate").mousedown(function(){n056();return false});$("#colorp").mousedown(function(){$.jPicker.List[0].show();return false});$("#save").mousedown(function(){n0da.n0c6();return false});$("#open").mousedown(function(){n0da.n0a4();return false});$("#addgeom").mouseup(n0bc);$("#erase").mouseup(n0bc);
$("#color").mouseup(n0bc);$("#save").mouseup(n0bc);$("#open").mouseup(n0bc);$("#undo").mousedown(function(){undo();return false});$("#undo").mouseup(n0bc);$("#redo").mousedown(function(){redo();return false});$("#redo").mouseup(n0bc);$("#undo").css("background-image","url('/images/noundo.png')");$("#redo").css("background-image","url('/images/noredo.png')");$("#tinlistdlg").mousedown(function(){$(this).fadeOut();return false});$("#helpscreen").mousedown(function(){n09e();return false});$("#tinlistdlg").mouseup(n0bc);
$("#helpscreen").mouseup(n0bc);document.addEventListener("DOMMouseScroll",n057,false);document.onmousewheel=n057;$(document).mouseup(n08e);$(document).mousedown(n063);$(document).mousemove(n06b);$("#sharebox #notready").click(function(){alert("Save the sketch first");return false});$("#sharebox #notready").mousedown(n0bc);$("#sharebox #notready").mouseup(n0bc)}function n080(){for(var a=["#add","#remove","#rotate"],b=0;b<3;b++)$(a[b]).css("border-left","solid 0px #a0a0a0")}
function n05c(a){$(a).css("border-left","solid 3px #a0a0a0")}function n09c(a){a||(a="");$("#bottombar #status").text(a)}function n095(){canvas.style.cursor="crosshair";action=n06c;n09c("Click to add a cube");n080();n05c("#add")}function n056(){canvas.style.cursor="move";action=n042;n09c("Click-n-Drag to rotate. Shift+Click to pan.");n080();n05c("#rotate")}function n060(){canvas.style.cursor="crosshair";action=n047;n09c("Click a cube to erase it");n080();n05c("#remove")}
function n043(a){n0d3=a;if(n0d3==n07c){n0db=0.1;n0e4=100;n0e0=5}else{n0db=0.1;n0e4=100;n0e0=n0db*Math.tan(n0da.zoom*Math.PI/360)}n0d9=n0e0*n0cb;$("#persp").css("background","rgba("+(n0d3==n079?"200,200,200,128":"0,0,0,0")+")");$("#ortho").css("background","rgba("+(n0d3==n07c?"200,200,200,128":"0,0,0,0")+")")}function n04e(){if(n0da.n0b1&&n0da.n0b1.n0b5)if(!confirm("You have unsaved changes. Proceed Anyway?"))return;n0da.n0ad(new n0d8);n0da.n0c4();n0da.draw();n03b()}
function undo(){n0da.n0b1.undo();n0da.draw()}function redo(){n0da.n0b1.redo();n0da.draw()}function n074(){canvas.style.cursor="auto";action=n094;n09c(null);n080();n09e();$("#tinlistdlg").fadeOut()}function n09e(){$("#helpscreen").fadeOut()}function n0a6(){var a=(canvas.height-300)/2;$("#helpscreen").css("margin-top",parseInt(a)+"px");a=(canvas.width-800)/2;$("#helpscreen").css("margin-left",parseInt(a)+"px");$("#helpscreen").fadeIn()}function n046(){canvas.style.cursor="move";n099=false}
function n040(a){n099=true;canvas.style.cursor="col-resize";n0c0=n013(a.clientX,canvas.height-a.clientY,canvas.width,canvas.height,n0da.project(V3.$(0,0,0)));n0c0=n0da.n097(n0c0)}function n030(){n045=false}function n02b(){n045=true}var n09d=null,moveCounter=0;
function n057(a){if(n0d3==n07c){if(a.detail>0)n0e0-=1;else if(a.detail<0)n0e0+=1;else if(a.wheelDelta>0)n0e0-=1;else if(a.wheelDelta<0)n0e0+=1;else log("No mousewheel info");if(n0e0<=1)n0e0=1;if(n0e0>=11)n0e0=11}else{var b=n0da.zoom;if(a.detail>0)b+=1;else if(a.detail<0)b-=1;else if(a.wheelDelta>0)b-=1;else if(a.wheelDelta<0)b+=1;else log("No mousewheel info");if(b>89)b=89;if(b<2)b=2;n0da.zoom=b;n0e0=n0db*Math.tan(n0da.zoom*Math.PI/360)}n0d9=n0e0*n0cb;n0da.draw();return false}var run_tests=function(){};
$(document).ready(function(){canvas=document.getElementById("canvas0");canvas.height=$(document).height()-50;canvas.width=$(document).width()-200;n051("pointer");n0cb=canvas.width/(1*canvas.height);n043(n07c);$("#creator").css("top",$(document).height()-50+"px");$("#creator").css("left",$(document).width()-120+"px");if(n0cc()){n0da.init();n066();n0a7();n08d();if(inittin!="_NULL_"){n0da.n0c2(inittin);n056()}else if(!n0da.n021())if(doLoadSample)n0da.n0c2("_SAMPLE_");else{n04e();n095()}$("#bottombar").css("top",
canvas.height+10);$("#bottombar").css("width",canvas.width)}});function n066(){$("#alpha").jPicker({window:{position:{x:"screenCenter",y:"screenCenter"},expandable:true,effects:{type:"fade"},alphaSupport:true},color:{active:new $.jPicker.Color({r:30,g:255,b:30,a:100})},images:{clientPath:"/images/jpicker/",picker:{file:"empty.png",width:0,height:0,padding:0,margin:0},doColorIcon:false}},function(a){n0da.n036(a.val("rgba"))},null,null,function(){n074()});n0da.n036({r:30,g:255,b:30,a:100})}
function proceedToLogin(){n0da.n05e();window.location=loginUrl}function n03b(){$("#sharebox").empty();$("#sharebox").append('<a id="notready" href="#"><img src="/images/twitter.gif" alt="Share on Twitter"/></a>');$("#sharebox").append('<a id="notready" href="#"><img src="/images/facebook.gif" alt="Share on Facebook"/></a>');$("#sharebox #notready").click(function(){alert("Save the sketch first");return false});$("#sharebox #notready").mousedown(n0bc);$("#sharebox #notready").mouseup(n0bc)}
function n034(){if(n0da.n0b1.uid!="_SAMPLE_"){var a="http://www.3dtin.com/"+n0da.n0b1.uid,b="http://3dt.in/"+n0da.n0b1.uid;$("#sharebox").empty();$("#sharebox").append('<a id="permalink" href="'+a+'">Permalink</a>');b='<a target="_blank" href="http://twitter.com/home?status='+encodeURI('Check out "'+n0da.n0b1.name+'" '+b)+'" title="Share on Twitter"><img src="/images/twitter.gif" alt="Share on Twitter"/></a>';$("#sharebox").append(b);a="<script>function fbs_click() {u="+a+";t=document.title;window.open('http://www.facebook.com/sharer.php?u='+encodeURIComponent(u)+'&t='+encodeURIComponent(t),'sharer','toolbar=0,status=0,width=626,height=436');return false;}<\/script><a href=\"http://www.facebook.com/share.php?u="+
a+'" onclick="return fbs_click()" target="_blank"><img src="/images/facebook.gif" alt="Share on Facebook" /></a>';$("#sharebox").append(a)}}function n048(){var a=document.createElement("canvas");a.width=128;a.height=128;a.getContext("2d").drawImage(canvas,0,0,canvas.width,canvas.height,0,0,128,128);return a.toDataURL("image/jpeg")}function n051(){}function log(a){window.console.info(a)};
